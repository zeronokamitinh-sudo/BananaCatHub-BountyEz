-- [[ BANANA CAT OVERLAY - ULTRA FINAL - ANTI-OVERLAP ]] --

local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local StatsService = game:GetService("Stats")

-- 1. Xóa sạch mọi thứ đang có để bắt đầu mới
local function ForceClear()
    for _, gui in pairs(PlayerGui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui.Name ~= "Chat" and gui.Name ~= "BubbleChat" and gui.Name ~= "TouchGui" then
            gui:Destroy()
        end
    end
end
ForceClear()

-- 2. Tạo giao diện Overlay duy nhất
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BananaCatOverlay_Final"
screenGui.Parent = PlayerGui
screenGui.IgnoreGuiInset = true 
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 2147483647 -- Ưu tiên cao nhất

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(1, 0, 1, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- 3. Nút HIDE UI (Thiết kế lại để không bị khuất)
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0.5, -50, 0, 20)
toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Text = "HIDE UI"
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.Parent = screenGui -- Đặt trực tiếp vào screenGui để luôn bấm được

local isHidden = false
toggleBtn.MouseButton1Click:Connect(function()
    isHidden = not isHidden
    mainFrame.Visible = not isHidden
    toggleBtn.Text = isHidden and "SHOW UI" or "HIDE UI"
    if PlayerGui:FindFirstChild("TouchGui") then
        PlayerGui.TouchGui.Enabled = isHidden
    end
end)

-- 4. Bố cục thông tin (Dùng UIListLayout để không bao giờ bị đè chữ)
local content = Instance.new("Frame")
content.Size = UDim2.new(0.8, 0, 0.6, 0)
content.Position = UDim2.new(0.5, 0, 0.5, 0)
content.AnchorPoint = Vector2.new(0.5, 0.5)
content.BackgroundTransparency = 1
content.Parent = mainFrame

local layout = Instance.new("UIListLayout")
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center
layout.Padding = UDim.new(0, 10)
layout.Parent = content

local function CreateLabel(size, color, textSize)
    local lb = Instance.new("TextLabel")
    lb.Size = size
    lb.BackgroundTransparency = 1
    lb.TextColor3 = color
    lb.TextSize = textSize
    lb.Font = Enum.Font.SourceSansBold
    lb.RichText = true
    lb.Parent = content
    return lb
end

local title = CreateLabel(UDim2.new(1,0,0,50), Color3.fromRGB(255,255,0), 35)
title.Text = "Banana Cat Hub <font color='rgb(255,0,0)'>Auto Bounty</font>"

local bountyLabel = CreateLabel(UDim2.new(1,0,0,40), Color3.fromRGB(255,255,255), 25)
local timeLabel = CreateLabel(UDim2.new(1,0,0,40), Color3.fromRGB(255,255,255), 25)
local systemLabel = CreateLabel(UDim2.new(1,0,0,30), Color3.fromRGB(0,255,0), 20)

-- --- LOGIC XỬ LÝ DỮ LIỆU ---
local startTime = tick()
local initialBounty = 0
local bountyVal = Player:WaitForChild("leaderstats", 20):WaitForChild("Bounty", 20)
initialBounty = bountyVal.Value

local function formatNumber(n)
    return tostring(n):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
end

task.spawn(function()
    while task.wait(0.5) do
        -- 1. Cập nhật thông tin
        local elapsed = tick() - startTime
        local h = math.floor(elapsed / 3600)
        local m = math.floor((elapsed % 3600) / 60)
        local s = math.floor(elapsed % 60)
        
        local currentBounty = bountyVal.Value
        local earned = currentBounty - initialBounty
        
        local ping = 0
        pcall(function() ping = math.floor(StatsService.Network.ServerStatsItem["Data Ping"]:GetValue()) end)
        
        bountyLabel.Text = "Bounty Earned: " .. formatNumber(earned) .. " (Total: " .. formatNumber(currentBounty) .. ")"
        timeLabel.Text = string.format("Time: %02dh:%02dm:%02ds", h, m, s)
        systemLabel.Text = string.format("FPS: %d | Players: %d | Ping: %dms", math.floor(1/RunService.RenderStepped:Wait()), #game.Players:GetPlayers(), ping)

        -- 2. CƠ CHẾ QUAN TRỌNG: Xóa mọi GUI lạ xuất hiện (Chống đè)
        if not isHidden then
            for _, gui in pairs(PlayerGui:GetChildren()) do
                if gui:IsA("ScreenGui") and gui.Name ~= "BananaCatOverlay_Final" and gui.Name ~= "Chat" and gui.Name ~= "TouchGui" then
                    gui.Enabled = false -- Vô hiệu hóa ngay lập tức
                end
            end
        end
    end
end)

if PlayerGui:FindFirstChild("TouchGui") then PlayerGui.TouchGui.Enabled = false end

-- 5. LOAD SCRIPT CHÍNH
loadstring(game:HttpGet("https://raw.githubusercontent.com/obiiyeuem/vthangsitink/refs/heads/main/BananaCat-BountyEz.lua"))()
